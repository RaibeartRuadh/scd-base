{% extends "base.html" %}

{% block title %}–§–∞–π–ª—ã —Ç–∞–Ω—Ü–∞ {{ dance.name }} - –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Ç–∞–Ω—Ü–µ–≤{% endblock %}

{% block content %}
<div class="container mt-4">
    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h1>üìÅ –§–∞–π–ª—ã —Ç–∞–Ω—Ü–∞: {{ dance.name }}</h1>
            <p class="text-muted">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ö–µ–º–∞–º–∏, —Å–∫–∞–Ω–∞–º–∏ –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏ –¥–ª—è —Ç–∞–Ω—Ü–∞</p>
        </div>
        <div>
            <a href="{{ url_for('view_dance', dance_id=dance.id) }}" class="btn btn-outline-secondary me-2">üëÅÔ∏è –ü—Ä–æ—Å–º–æ—Ç—Ä —Ç–∞–Ω—Ü–∞</a>
            <a href="{{ url_for('edit_dance', dance_id=dance.id) }}" class="btn btn-outline-primary me-2">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>
            <a href="{{ url_for('index') }}" class="btn btn-outline-info">üìã –ö –∫–∞—Ç–∞–ª–æ–≥—É</a>
        </div>
    </div>

    <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–∞–Ω—Ü–µ -->
    <div class="card mb-4">
        <div class="card-body">
            <div class="row">
                <div class="col-md-6">
                    <strong>–ù–∞–∑–≤–∞–Ω–∏–µ:</strong> {{ dance.name }}<br>
                    <strong>–ê–≤—Ç–æ—Ä:</strong> {{ dance.author or '–ù–µ —É–∫–∞–∑–∞–Ω' }}<br>
                    <strong>–¢–∏–ø:</strong> 
                    {% if dance.dance_type_rel %}
                        <span class="badge 
                            {% if dance.dance_type_rel.name == 'Reel' %}bg-primary
                            {% elif dance.dance_type_rel.name == 'Jig' %}bg-success
                            {% elif dance.dance_type_rel.name == 'Strathspey' %}bg-warning
                            {% else %}bg-secondary{% endif %}">
                            {{ dance.dance_type_rel.name }}
                        </span>
                    {% else %}
                        <span class="badge bg-secondary">-</span>
                    {% endif %}
                </div>
                <div class="col-md-6">
                    <strong>–†–∞–∑–º–µ—Ä:</strong> 
                    {% if dance.count_id and dance.size_id %}
                        {{ dance.count_id }}x{{ dance.size_id }}
                    {% elif dance.size_id %}
                        {{ dance.size_id }} —Ç–∞–∫—Ç–æ–≤
                    {% else %}
                        -
                    {% endif %}<br>
                    <strong>–§–æ—Ä–º–∞—Ç:</strong> {{ dance.dance_format_rel.name if dance.dance_format_rel else '-' }}<br>
                    <strong>–¢–∏–ø —Å–µ—Ç–∞:</strong> {{ dance.set_type_rel.name if dance.set_type_rel else '-' }}
                </div>
            </div>
        </div>
    </div>

    <!-- –§–æ—Ä–º–∞ –∑–∞–≥—Ä—É–∑–∫–∏ -->
    <div class="card mb-4">
        <div class="card-header bg-primary text-white">
            <h5 class="mb-0">üì§ –ó–∞–≥—Ä—É–∑–∏—Ç—å –Ω–æ–≤—ã–π —Ñ–∞–π–ª</h5>
        </div>
        <div class="card-body">
            <form method="POST" action="{{ url_for('upload_dance_file', dance_id=dance.id) }}" enctype="multipart/form-data">
                <div class="row g-3 align-items-end">
                    <div class="col-md-8">
                        <label for="file" class="form-label">–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª:</label>
                        <input type="file" class="form-control" id="file" name="file" required
                               accept=".png,.jpg,.jpeg,.gif,.pdf,.txt,.doc,.docx">
                        <div class="form-text">
                            üìé –†–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã: PNG, JPG, JPEG, GIF, PDF, TXT, DOC, DOCX (–º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: 16MB)
                        </div>
                    </div>
                    <div class="col-md-4">
                        <button type="submit" class="btn btn-success w-100">
                            <i class="fas fa-upload"></i> –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- –°–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤ -->
    <div class="card">
        <div class="card-header bg-secondary text-white d-flex justify-content-between align-items-center">
            <h5 class="mb-0">üìã –ó–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã</h5>
            <span class="badge bg-light text-dark">{{ files|length }} —Ñ–∞–π–ª(–æ–≤)</span>
        </div>
        <div class="card-body">
            {% if files %}
            <div class="table-responsive">
                <table class="table table-striped table-hover">
                    <thead class="table-dark">
                        <tr>
                            <th width="50%">–ò–º—è —Ñ–∞–π–ª–∞</th>
                            <th width="15%">–†–∞–∑–º–µ—Ä</th>
                            <th width="20%">–ó–∞–≥—Ä—É–∂–µ–Ω</th>
                            <th width="15%">–î–µ–π—Å—Ç–≤–∏—è</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for file in files %}
                        <tr>
                            <td>
                                <div class="d-flex align-items-center">
                                    {% if file.name.lower().endswith(('.png', '.jpg', '.jpeg', '.gif')) %}
                                        <i class="fas fa-image text-primary me-2"></i>
                                    {% elif file.name.lower().endswith('.pdf') %}
                                        <i class="fas fa-file-pdf text-danger me-2"></i>
                                    {% elif file.name.lower().endswith(('.doc', '.docx')) %}
                                        <i class="fas fa-file-word text-primary me-2"></i>
                                    {% elif file.name.lower().endswith('.txt') %}
                                        <i class="fas fa-file-alt text-info me-2"></i>
                                    {% else %}
                                        <i class="fas fa-file text-secondary me-2"></i>
                                    {% endif %}
                                    <div>
                                        <strong>{{ file.name }}</strong>
                                        <br>
                                        <small class="text-muted">
                                            {% if file.name.lower().endswith(('.png', '.jpg', '.jpeg', '.gif')) %}
                                                –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                                            {% elif file.name.lower().endswith('.pdf') %}
                                                PDF –¥–æ–∫—É–º–µ–Ω—Ç
                                            {% elif file.name.lower().endswith(('.doc', '.docx')) %}
                                                Word –¥–æ–∫—É–º–µ–Ω—Ç
                                            {% elif file.name.lower().endswith('.txt') %}
                                                –¢–µ–∫—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª
                                            {% else %}
                                                –§–∞–π–ª
                                            {% endif %}
                                        </small>
                                    </div>
                                </div>
                            </td>
                            <td>
                                <span class="badge bg-light text-dark">
                                    {% if file.size < 1024 %}
                                        {{ file.size }} –±–∞–π—Ç
                                    {% elif file.size < 1048576 %}
                                        {{ (file.size / 1024)|round|int }} –ö–ë
                                    {% else %}
                                        {{ (file.size / 1048576)|round(1) }} –ú–ë
                                    {% endif %}
                                </span>
                            </td>
                            <td>
                                <small class="text-muted">
                                    {{ format_datetime(file.upload_time) }}
                                </small>
                            </td>
                            <td>
                                <div class="btn-group btn-group-sm" role="group">
                                    <a href="{{ url_for('download_dance_file', dance_id=dance.id, filename=file.name) }}" 
                                       class="btn btn-outline-success" 
                                       title="–°–∫–∞—á–∞—Ç—å —Ñ–∞–π–ª"
                                       target="_blank">
                                        <i class="fas fa-download"></i>
                                    </a>
                                    
                                    {% if file.name.lower().endswith(('.png', '.jpg', '.jpeg', '.gif')) %}
                                    <a href="{{ url_for('download_dance_file', dance_id=dance.id, filename=file.name) }}" 
                                       class="btn btn-outline-info"
                                       title="–ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ"
                                       target="_blank">
                                        <i class="fas fa-eye"></i>
                                    </a>
                                    {% endif %}
                                </div>
                                
                                <!-- –§–æ—Ä–º–∞ —É–¥–∞–ª–µ–Ω–∏—è –æ—Ç–¥–µ–ª—å–Ω–æ -->
                                <form method="POST" 
                                      action="{{ url_for('delete_dance_file', dance_id=dance.id, filename=file.name) }}" 
                                      class="d-inline mt-1"
                                      onsubmit="return confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —Ñ–∞–π–ª \"{{ file.name }}\"?')">
                                    <button type="submit" class="btn btn-outline-danger btn-sm" title="–£–¥–∞–ª–∏—Ç—å —Ñ–∞–π–ª">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </form>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <div class="text-center py-5">
                <div class="text-muted mb-3">
                    <i class="fas fa-folder-open fa-4x"></i>
                </div>
                <h4>–§–∞–π–ª—ã –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã</h4>
                <p class="text-muted">–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Å—Ö–µ–º—ã, —Å–∫–∞–Ω—ã –∏–ª–∏ –¥–æ–∫—É–º–µ–Ω—Ç—ã –¥–ª—è —ç—Ç–æ–≥–æ —Ç–∞–Ω—Ü–∞</p>
                <p class="text-muted">–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ–æ—Ä–º—É –≤—ã—à–µ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –ø–µ—Ä–≤–æ–≥–æ —Ñ–∞–π–ª–∞</p>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è -->
    <div class="mt-4">
        <div class="row">
            <div class="col-md-4">
                <div class="card text-center file-action-card">
                    <div class="card-body">
                        <i class="fas fa-upload fa-2x text-primary mb-2"></i>
                        <h6>–ó–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ö–µ–º—É</h6>
                        <p class="text-muted small">PNG, JPG –¥–æ 16MB</p>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card text-center file-action-card">
                    <div class="card-body">
                        <i class="fas fa-file-pdf fa-2x text-danger mb-2"></i>
                        <h6>–ó–∞–≥—Ä—É–∑–∏—Ç—å —Å–∫–∞–Ω</h6>
                        <p class="text-muted small">PDF –¥–æ–∫—É–º–µ–Ω—Ç—ã</p>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card text-center file-action-card">
                    <div class="card-body">
                        <i class="fas fa-sticky-note fa-2x text-success mb-2"></i>
                        <h6>–ó–∞–≥—Ä—É–∑–∏—Ç—å –∑–∞–º–µ—Ç–∫–∏</h6>
                        <p class="text-muted small">TXT, DOC —Ñ–∞–π–ª—ã</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

<!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–∞–ø–∫–µ -->
<div class="mt-4 text-center">
    <small class="text-muted">
        <i class="fas fa-info-circle"></i>
        –§–∞–π–ª—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ —Å–∏—Å—Ç–µ–º–Ω–æ–π –ø–∞–ø–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    </small>
</div>

<style>
.file-action-card {
    transition: transform 0.2s;
    height: 100%;
}
.file-action-card:hover {
    transform: translateY(-2px);
}
.btn-group-sm .btn {
    padding: 0.25rem 0.5rem;
}
</style>
{% endblock %}