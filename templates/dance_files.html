{% extends "base.html" %}

{% block title %}–§–∞–π–ª—ã —Ç–∞–Ω—Ü–∞ {{ dance.name }} - –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Ç–∞–Ω—Ü–µ–≤{% endblock %}

{% block content %}
<div class="container mt-4">
    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h1>üìÅ –§–∞–π–ª—ã —Ç–∞–Ω—Ü–∞: {{ dance.name }}</h1>
            <p class="text-muted">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ö–µ–º–∞–º–∏, —Å–∫–∞–Ω–∞–º–∏ –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏ —Å–≤—è–∑–∞–Ω–Ω—ã–º–∏ —Å —Ç–∞–Ω—Ü–µ–º</p>
        </div>
        <div>
            <a href="{{ url_for('view_dance', dance_id=dance.id) }}" class="btn btn-outline-secondary me-2">‚Üê –ü—Ä–æ—Å–º–æ—Ç—Ä —Ç–∞–Ω—Ü–∞</a>
            <a href="{{ url_for('edit_dance', dance_id=dance.id) }}" class="btn btn-outline-primary me-2">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>
        </div>
    </div>

    <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–∞–Ω—Ü–µ -->
    <div class="card mb-4">
        <div class="card-body">
            <div class="row">
                <div class="col-md-6">
                    <strong>–ù–∞–∑–≤–∞–Ω–∏–µ:</strong> {{ dance.name }}<br>
                    <strong>–ê–≤—Ç–æ—Ä:</strong> {{ dance.author or '–ù–µ —É–∫–∞–∑–∞–Ω' }}<br>
                    <strong>–¢–∏–ø:</strong> 
                    {% if dance.dance_type %}
                        <span class="badge 
                            {% if dance.dance_type.name == 'Reel' %}bg-primary
                            {% elif dance.dance_type.name == 'Jig' %}bg-success
                            {% elif dance.dance_type.name == 'Strathspey' %}bg-warning
                            {% else %}bg-secondary{% endif %}">
                            {{ dance.dance_type.name }}
                        </span>
                    {% else %}
                        <span class="badge bg-secondary">-</span>
                    {% endif %}
                </div>
                <div class="col-md-6">
                    <strong>–†–∞–∑–º–µ—Ä:</strong> 
                    {% if dance.count_id and dance.size_id %}
                        {{ dance.count_id }}x{{ dance.size_id }}
                    {% elif dance.size_id %}
                        {{ dance.size_id }} —Ç–∞–∫—Ç–æ–≤
                    {% else %}
                        -
                    {% endif %}<br>
                    <strong>–§–æ—Ä–º–∞—Ç:</strong> {{ dance.dance_format.name if dance.dance_format else '-' }}<br>
                    <strong>–¢–∏–ø —Å–µ—Ç–∞:</strong> {{ dance.set_type.name if dance.set_type else '-' }}
                </div>
            </div>
        </div>
    </div>

    <!-- –§–æ—Ä–º–∞ –∑–∞–≥—Ä—É–∑–∫–∏ -->
    <div class="card mb-4">
        <div class="card-header bg-primary text-white">
            <h5 class="mb-0"><i class="fas fa-upload me-2"></i>–ó–∞–≥—Ä—É–∑–∏—Ç—å –Ω–æ–≤—ã–π —Ñ–∞–π–ª</h5>
        </div>
        <div class="card-body">
            <form method="POST" action="{{ url_for('upload_dance_file', dance_id=dance.id) }}" enctype="multipart/form-data">
                <div class="mb-3">
                    <label for="file" class="form-label fw-bold">–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏</label>
                    <div class="input-group">
                        <input type="file" class="form-control" id="file" name="file" required
                               accept=".png,.jpg,.jpeg,.gif,.pdf,.txt,.doc,.docx,.svg">
                        <button type="submit" class="btn btn-success">
                            <i class="fas fa-upload me-2"></i>–ó–∞–≥—Ä—É–∑–∏—Ç—å
                        </button>
                    </div>
                    <div class="form-text mt-2">
                        <i class="fas fa-info-circle me-1"></i>
                        –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã: –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (PNG, JPG, GIF, SVG), –¥–æ–∫—É–º–µ–Ω—Ç—ã (PDF, TXT, DOC, DOCX). –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: 16MB
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏ –¥–æ–∫—É–º–µ–Ω—Ç—ã -->
    
    <!-- –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è -->
    {% if images %}
    <div class="card mb-4">
        <div class="card-header bg-info text-white d-flex justify-content-between align-items-center">
            <h5 class="mb-0"><i class="fas fa-images me-2"></i>–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</h5>
            <span class="badge bg-light text-dark">{{ images|length }} —Ñ–∞–π–ª(–æ–≤)</span>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-striped table-hover">
                    <thead class="table-dark">
                        <tr>
                            <th width="50%">–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</th>
                            <th width="15%">–†–∞–∑–º–µ—Ä</th>
                            <th width="20%">–¢–∏–ø</th>
                            <th width="15%" class="text-center">–î–µ–π—Å—Ç–≤–∏—è</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for image in images %}
                        <tr>
                            <td>
                                <div class="d-flex align-items-center">
                                    <i class="fas fa-image text-primary me-2"></i>
                                    <div>
                                        <strong>{{ image.filename }}</strong>
                                        <br>
                                        <small class="text-muted">
                                            {% if image.filename.lower().endswith('.svg') %}
                                                SVG –¥–∏–∞–≥—Ä–∞–º–º–∞
                                            {% else %}
                                                –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                                            {% endif %}
                                        </small>
                                    </div>
                                </div>
                            </td>
                            <td>
                                <span class="badge bg-light text-dark">
                                    {% if image.size %}
                                        {% if image.size < 1024 %}
                                            {{ image.size }} –±–∞–π—Ç
                                        {% elif image.size < 1048576 %}
                                            {{ (image.size / 1024)|round|int }} –ö–ë
                                        {% else %}
                                            {{ (image.size / 1048576)|round(1) }} –ú–ë
                                        {% endif %}
                                    {% else %}
                                        –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ
                                    {% endif %}
                                </span>
                            </td>
                            <td>
                                <small class="text-muted">
                                    {% if image.filename.lower().endswith('.svg') %}
                                        SVG
                                    {% elif image.filename.lower().endswith('.png') %}
                                        PNG
                                    {% elif image.filename.lower().endswith(('.jpg', '.jpeg')) %}
                                        JPG
                                    {% elif image.filename.lower().endswith('.gif') %}
                                        GIF
                                    {% else %}
                                        –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                                    {% endif %}
                                </small>
                            </td>
                            <td>
                                <div class="d-flex justify-content-center align-items-center gap-2" style="min-height: 40px;">
                                    <!-- –°–∫–∞—á–∞—Ç—å -->
                                    <a href="{{ url_for('serve_dance_image', dance_id=dance.id, filename=image.filename) }}" 
                                       class="material-icon-action" 
                                       title="–°–∫–∞—á–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ"
                                       download="{{ image.filename }}">
                                        <img src="{{ url_for('static', filename='img/download.png') }}" alt="–°–∫–∞—á–∞—Ç—å" style="width: 25px; height: 25px;">
                                    </a>
                                    
                                    <!-- –ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å -->
                                    <a href="{{ url_for('serve_dance_image', dance_id=dance.id, filename=image.filename) }}" 
                                       class="material-icon-action"
                                       title="–ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ"
                                       target="_blank">
                                        <img src="{{ url_for('static', filename='img/eye.png') }}" alt="–ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å" style="width: 25px; height: 25px;">
                                    </a>
                                    
                                    <!-- –£–¥–∞–ª–∏—Ç—å -->
                                    <form method="POST" 
                                          action="{{ url_for('delete_dance_file', dance_id=dance.id, filename=image.filename) }}" 
                                          class="d-inline m-0"
                                          onsubmit="return confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ \"{{ image.filename }}\"?')">
                                        <button type="submit" class="material-icon-action btn p-0 border-0 bg-transparent" title="–£–¥–∞–ª–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ">
                                            <img src="{{ url_for('static', filename='img/trash.png') }}" alt="–£–¥–∞–ª–∏—Ç—å" style="width: 25px; height: 25px;">
                                        </button>
                                    </form>
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- –î–æ–∫—É–º–µ–Ω—Ç—ã –∏ –¥—Ä—É–≥–∏–µ —Ñ–∞–π–ª—ã -->
    {% if files %}
    <div class="card">
        <div class="card-header bg-secondary text-white d-flex justify-content-between align-items-center">
            <h5 class="mb-0"><i class="fas fa-file me-2"></i>–î–æ–∫—É–º–µ–Ω—Ç—ã –∏ –¥—Ä—É–≥–∏–µ —Ñ–∞–π–ª—ã</h5>
            <span class="badge bg-light text-dark">{{ files|length }} —Ñ–∞–π–ª(–æ–≤)</span>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-striped table-hover">
                    <thead class="table-dark">
                        <tr>
                            <th width="50%">–î–æ–∫—É–º–µ–Ω—Ç</th>
                            <th width="15%">–†–∞–∑–º–µ—Ä</th>
                            <th width="20%">–¢–∏–ø</th>
                            <th width="15%" class="text-center">–î–µ–π—Å—Ç–≤–∏—è</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for file in files %}
                        <tr>
                            <td>
                                <div class="d-flex align-items-center">
                                    {% if file.filename.lower().endswith('.pdf') %}
                                        <i class="fas fa-file-pdf text-danger me-2"></i>
                                    {% elif file.filename.lower().endswith(('.doc', '.docx')) %}
                                        <i class="fas fa-file-word text-primary me-2"></i>
                                    {% elif file.filename.lower().endswith('.txt') %}
                                        <i class="fas fa-file-alt text-info me-2"></i>
                                    {% else %}
                                        <i class="fas fa-file text-secondary me-2"></i>
                                    {% endif %}
                                    <div>
                                        <strong>{{ file.filename }}</strong>
                                        <br>
                                        <small class="text-muted">
                                            {% if file.filename.lower().endswith('.pdf') %}
                                                PDF –¥–æ–∫—É–º–µ–Ω—Ç
                                            {% elif file.filename.lower().endswith(('.doc', '.docx')) %}
                                                Word –¥–æ–∫—É–º–µ–Ω—Ç
                                            {% elif file.filename.lower().endswith('.txt') %}
                                                –¢–µ–∫—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª
                                            {% else %}
                                                –§–∞–π–ª
                                            {% endif %}
                                        </small>
                                    </div>
                                </div>
                            </td>
                            <td>
                                <span class="badge bg-light text-dark">
                                    {% if file.size %}
                                        {% if file.size < 1024 %}
                                            {{ file.size }} –±–∞–π—Ç
                                        {% elif file.size < 1048576 %}
                                            {{ (file.size / 1024)|round|int }} –ö–ë
                                        {% else %}
                                            {{ (file.size / 1048576)|round(1) }} –ú–ë
                                        {% endif %}
                                    {% else %}
                                        –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ
                                    {% endif %}
                                </span>
                            </td>
                            <td>
                                <small class="text-muted">
                                    {% if file.filename.lower().endswith('.pdf') %}
                                        PDF
                                    {% elif file.filename.lower().endswith('.docx') %}
                                        Word
                                    {% elif file.filename.lower().endswith('.doc') %}
                                        Word
                                    {% elif file.filename.lower().endswith('.txt') %}
                                        –¢–µ–∫—Å—Ç
                                    {% else %}
                                        –§–∞–π–ª
                                    {% endif %}
                                </small>
                            </td>
                            <td>
                                <div class="d-flex justify-content-center align-items-center gap-2" style="min-height: 40px;">
                                    <!-- –°–∫–∞—á–∞—Ç—å -->
                                    <a href="{{ url_for('download_dance_file', dance_id=dance.id, filename=file.filename) }}" 
                                       class="material-icon-action" 
                                       title="–°–∫–∞—á–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç"
                                       download="{{ file.filename }}">
                                        <img src="{{ url_for('static', filename='img/download.png') }}" alt="–°–∫–∞—á–∞—Ç—å" style="width: 25px; height: 25px;">
                                    </a>
                                    
                                    <!-- –ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å -->
                                    {% if file.filename.lower().endswith(('.pdf', '.txt', '.doc', '.docx')) %}
                                    <a href="{{ url_for('download_dance_file', dance_id=dance.id, filename=file.filename) }}" 
                                       class="material-icon-action"
                                       title="–ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç"
                                       target="_blank">
                                        <img src="{{ url_for('static', filename='img/eye.png') }}" alt="–ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å" style="width: 25px; height: 25px;">
                                    </a>
                                    {% endif %}
                                    
                                    <!-- –£–¥–∞–ª–∏—Ç—å -->
                                    <form method="POST" 
                                          action="{{ url_for('delete_dance_file', dance_id=dance.id, filename=file.filename) }}" 
                                          class="d-inline m-0"
                                          onsubmit="return confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç \"{{ file.filename }}\"?')">
                                        <button type="submit" class="material-icon-action btn p-0 border-0 bg-transparent" title="–£–¥–∞–ª–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç">
                                            <img src="{{ url_for('static', filename='img/trash.png') }}" alt="–£–¥–∞–ª–∏—Ç—å" style="width: 25px; height: 25px;">
                                        </button>
                                    </form>
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- –°–æ–æ–±—â–µ–Ω–∏–µ –µ—Å–ª–∏ –Ω–µ—Ç —Ñ–∞–π–ª–æ–≤ -->
    {% if not files and not images %}
    <div class="card">
        <div class="card-body text-center py-5">
            <div class="text-muted mb-3">
                <i class="fas fa-folder-open fa-4x"></i>
            </div>
            <h4>–§–∞–π–ª—ã –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã</h4>
            <p class="text-muted">–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Å—Ö–µ–º—ã, —Å–∫–∞–Ω—ã –∏–ª–∏ –¥–æ–∫—É–º–µ–Ω—Ç—ã –¥–ª—è —ç—Ç–æ–≥–æ —Ç–∞–Ω—Ü–∞</p>
            <p class="text-muted">–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ–æ—Ä–º—É –≤—ã—à–µ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –ø–µ—Ä–≤–æ–≥–æ —Ñ–∞–π–ª–∞</p>
        </div>
    </div>
    {% endif %}
</div>

<style>
.file-action-card {
    transition: transform 0.2s;
    height: 100%;
}
.file-action-card:hover {
    transform: translateY(-2px);
}
.btn-group-sm .btn {
    padding: 0.25rem 0.5rem;
}
.upload-card .input-group .btn {
    border-top-left-radius: 0;
    border-bottom-left-radius: 0;
}
.upload-card .form-text {
    font-size: 0.875rem;
    color: #6c757d;
}

/* –°—Ç–∏–ª–∏ –¥–ª—è –∏–∫–æ–Ω–æ–∫ –¥–µ–π—Å—Ç–≤–∏–π –∫–∞–∫ –Ω–∞ index.html */
.material-icon-action {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s ease;
    opacity: 0.8;
    padding: 2px;
    border-radius: 4px;
}

.material-icon-action:hover {
    opacity: 1;
    transform: scale(1.1);
    background-color: rgba(0, 0, 0, 0.05);
}

/* –í—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã –∏–∫–æ–Ω–æ–∫ */
.d-flex.gap-2 {
    gap: 0.5rem !important;
}

/* –í—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ —Å—Ç–æ–ª–±—Ü–∞ –¥–µ–π—Å—Ç–≤–∏–π */
.table td:last-child {
    vertical-align: middle;
}

/* –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤—ã—Å–æ—Ç–∞ –¥–ª—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –∏–∫–æ–Ω–æ–∫ */
.actions-container {
    min-height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
}
</style>
{% endblock %}