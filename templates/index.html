{% extends "base.html" %}
[file name]: index.html
[file content begin]
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h3 class="mb-0">Все танцы</h3>
    
    <!-- Форма быстрого поиска в центре -->
    <form method="get" class="d-flex align-items-center mx-auto">
        <div class="input-group" style="max-width: 400px;">
            <input type="text" 
                   class="form-control form-control-sm" 
                   name="search" 
                   value="{{ search }}" 
                   placeholder="Быстрый поиск...">
            <input type="hidden" name="per_page" value="{{ per_page }}">
            <button type="submit" class="btn btn-outline-secondary btn-sm d-flex align-items-center justify-content-center" 
                    style="border: 1px solid #ced4da; border-left: none; padding: 0.25rem 0.5rem;">
                <img src="{{ url_for('static', filename='img/search.png') }}" alt="Поиск" style="width: 25px; height: 25px;">
            </button>
            {% if search %}
            <a href="{{ url_for('index') }}" class="btn btn-outline-secondary btn-sm d-flex align-items-center justify-content-center ms-1"
               style="padding: 0.25rem 0.5rem;">
                Сбросить
            </a>
            {% endif %}
        </div>
    </form>
    
    <a href="{{ url_for('add_dance') }}" class="btn btn-primary btn-sm">
        Добавить танец
    </a>
</div>

<!-- Фильтры -->
<div class="row mb-3">
    <div class="col-md-6">
        <form method="get" class="row g-2 align-items-center">
            <div class="col-auto">
                <label class="col-form-label text-muted small">Показать:</label>
            </div>
            <div class="col-auto">
                <select class="form-select form-select-sm" id="per_page" name="per_page" onchange="this.form.submit()">
                    <option value="15" {% if per_page==15 %}selected{% endif %}>15</option>
                    <option value="50" {% if per_page==50 %}selected{% endif %}>50</option>
                    <option value="100" {% if per_page==100 %}selected{% endif %}>100</option>
                </select>
            </div>
            <input type="hidden" name="search" value="{{ search }}">
        </form>
    </div>
    <div class="col-md-6">
        <!-- Пустая колонка для балансировки -->
    </div>
</div>

<!-- Таблица танцев с фиксированной шириной столбцов -->
<div class="card border-0 shadow-sm">
    <div class="table-responsive">
        <table class="table table-hover mb-0 table-compact fixed-columns">
            <thead class="table-dark">
                <tr>
                    <th width="60" class="text-center">ID</th>
                    <th width="280">Название</th>
                    <th width="120">Тип</th>
                    <th width="130">Формат сета</th>
                    <th width="130">Тип сета</th>
                    <th width="100">Размер</th>
                    <th width="90" class="text-center">Материалы</th>
                    <th width="140" class="text-center">Действия</th>
                </tr>
            </thead>
            <tbody>
                {% if dances and dances.items %}
                    {% for dance in dances.items %}
                    <tr class="align-middle">
                        <td class="text-muted text-center">
                            {{ dance.id }}
                        </td>
                        <td>
                            <a href="{{ url_for('view_dance', dance_id=dance.id) }}" 
                               class="text-decoration-none fw-bold dance-name text-truncate d-block"
                               title="{{ dance.name }}">
                                {{ dance.name }}
                            </a>
                        </td>
                        <!-- Тип танца -->
                        <td>
                            {% if dance.dance_type %}
                                <span class="badge badge-type 
                                    {% if dance.dance_type.name == 'Reel' %}bg-reel
                                    {% elif dance.dance_type.name == 'Jig' %}bg-jig
                                    {% elif dance.dance_type.name == 'Strathspey' %}bg-strathspey
                                    {% elif dance.dance_type.name == 'Medley' %}bg-medley
                                    {% elif dance.dance_type.name == 'Polka' %}bg-polka
                                    {% elif dance.dance_type.name == 'March' %}bg-march
                                    {% elif dance.dance_type.name == 'Waltz' %}bg-waltz
                                    {% elif dance.dance_type.name == 'Hornpipe' %}bg-hornpipe
                                    {% elif dance.dance_type.name == 'Quadrille' %}bg-quadrille
                                    {% elif dance.dance_type.name == 'Minuet' %}bg-minuet
                                    {% else %}bg-secondary{% endif %}">
                                    {{ dance.dance_type.name }}
                                </span>
                            {% else %}
                                <span class="badge bg-light text-muted">-</span>
                            {% endif %}
                        </td>
                        <!-- Формат сета -->
                        <td>
                            {% if dance.dance_format %}
                                <span class="dance-format text-truncate d-block" title="{{ dance.dance_format.name }}">
                                    {{ dance.dance_format.name }}
                                </span>
                            {% else %}
                                <span class="dance-format">-</span>
                            {% endif %}
                        </td>
                        <!-- Тип сета -->
                        <td>
                            {% if dance.set_type %}
                                <span class="dance-set-type text-truncate d-block" title="{{ dance.set_type.name }}">
                                    {{ dance.set_type.name }}
                                </span>
                            {% else %}
                                <span class="dance-set-type">-</span>
                            {% endif %}
                        </td>
                        <td>
                            {% if dance.count_id and dance.size_id %}
                                <span class="dance-size">
                                    {{ dance.count_id }}×{{ dance.size_id }}
                                </span>
                            {% elif dance.size_id %}
                                <span class="dance-size">
                                    {{ dance.size_id }} тактов
                                </span>
                            {% else %}
                                <span class="dance-size">-</span>
                            {% endif %}
                        </td>
                        <td class="text-center">
                            <div class="d-flex justify-content-center gap-1">
                                <!-- Иконка короны для RSCDS танцев -->
                                {% if dance.rscds %}
                                <img src="{{ url_for('static', filename='img/crown.png') }}" 
                                     alt="RSCDS" 
                                     class="material-icon" 
                                     title="Танец RSCDS"
                                     style="width: 25px; height: 25px; opacity: 0.8;">
                                {% endif %}
                                
                                <!-- Иконка описания (газета) -->
                                {% if dance.has_any_description %}
                                <img src="{{ url_for('static', filename='img/newspaper.png') }}" 
                                     alt="Описание" 
                                     class="material-icon" 
                                     title="Есть описание танца или e-cribs"
                                     style="width: 25px; height: 25px; opacity: 0.8;">
                                {% endif %}
                                
                                <!-- Иконка файлов (картина) -->
                                {% set dance_files = get_dance_files(dance.id, dance.name) %}
                                {% set dance_images = get_dance_images(dance.id, dance.name) %}
                                {% if dance_files or dance_images %}
                                <img src="{{ url_for('static', filename='img/image.png') }}" 
                                     alt="Файлы" 
                                     class="material-icon" 
                                     title="Есть дополнительные материалы"
                                     style="width: 25px; height: 25px; opacity: 0.8;">
                                {% endif %}
                            </div>
                        </td>
                        <td class="text-center">
                            <div class="d-flex justify-content-center gap-2">
                                <!-- Файлы - папка -->
                                <a href="{{ url_for('dance_files', dance_id=dance.id) }}" 
                                class="material-icon-action" 
                                title="Материалы к танцу">
                                    <img src="{{ url_for('static', filename='img/folder.png') }}" alt="Материалы" style="width: 25px; height: 25px;">
                                </a>
                                
                                <!-- Редактировать - карандаш -->
                                <a href="{{ url_for('edit_dance', dance_id=dance.id) }}" 
                                class="material-icon-action" 
                                title="Редактировать">
                                    <img src="{{ url_for('static', filename='img/edit.png') }}" alt="Редактировать" style="width: 25px; height: 25px;">
                                </a>
                                
                                <!-- Удалить - корзина (скрыто) -->
                                <button type="button" 
                                        class="material-icon-action btn p-0 border-0 bg-transparent" 
                                        onclick="confirmSingleDelete({{ dance.id }}, '{{ dance.name|replace("'", "\\'") }}')"
                                        title="Удалить"
                                        style="display: none;">
                                    <img src="{{ url_for('static', filename='img/trash.png') }}" alt="Удалить" style="width: 25px; height: 25px;">
                                </button>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                {% else %}
                <tr>
                    <td colspan="8" class="text-center py-4">
                        <div class="py-3">
                            {% if search %}
                                <h6 class="text-muted mb-1">Танцы по запросу "{{ search }}" не найдены</h6>
                            {% else %}
                                <img src="{{ url_for('static', filename='img/music.png') }}" alt="Музыка" class="mb-2" style="width: 24px; height: 24px; opacity: 0.5;">
                                <h6 class="text-muted mb-1">Танцы не найдены</h6>
                                <p class="text-muted mb-0 small"><a href="{{ url_for('add_dance') }}" class="text-decoration-none">Добавьте первый танец!</a></p>
                            {% endif %}
                        </div>
                    </td>
                </tr>
                {% endif %}
            </tbody>
        </table>
    </div>
</div>

<!-- Пагинация -->
{% if dances and dances.pages > 1 %}
<div class="mt-4">
    <nav aria-label="Page navigation">
        <ul class="pagination justify-content-center mb-2 pagination-sm">
            <!-- Первая страница -->
            {% if dances.page > 1 %}
            <li class="page-item">
                <a class="page-link" href="{{ url_for('index', page=1, per_page=per_page, search=search) }}" aria-label="First">
                    <img src="{{ url_for('static', filename='img/double-arrow-left.png') }}" alt="Первая" style="width: 25px; height: 25px;">
                </a>
            </li>
            {% else %}
            <li class="page-item disabled">
                <span class="page-link"><img src="{{ url_for('static', filename='img/double-arrow-left.png') }}" alt="Первая" style="width: 25px; height: 25px; opacity: 0.3;"></span>
            </li>
            {% endif %}

            <!-- Предыдущая страница -->
            {% if dances.has_prev %}
            <li class="page-item">
                <a class="page-link" href="{{ url_for('index', page=dances.prev_num, per_page=per_page, search=search) }}" aria-label="Previous">
                    <img src="{{ url_for('static', filename='img/arrow-left.png') }}" alt="Предыдущая" style="width: 25px; height: 25px;">
                </a>
            </li>
            {% else %}
            <li class="page-item disabled">
                <span class="page-link"><img src="{{ url_for('static', filename='img/arrow-left.png') }}" alt="Предыдущая" style="width: 25px; height: 25px; opacity: 0.3;"></span>
            </li>
            {% endif %}

            <!-- Номера страниц -->
            {% if dances.iter_pages %}
                {% for page_num in dances.iter_pages(left_edge=2, left_current=2, right_current=2, right_edge=2) %}
                    {% if page_num %}
                        <li class="page-item {% if page_num == dances.page %}active{% endif %}">
                            <a class="page-link" href="{{ url_for('index', page=page_num, per_page=per_page, search=search) }}">{{ page_num }}</a>
                        </li>
                    {% else %}
                        <li class="page-item disabled"><span class="page-link">...</span></li>
                    {% endif %}
                {% endfor %}
            {% endif %}

            <!-- Следующая страница -->
            {% if dances.has_next %}
            <li class="page-item">
                <a class="page-link" href="{{ url_for('index', page=dances.next_num, per_page=per_page, search=search) }}" aria-label="Next">
                    <img src="{{ url_for('static', filename='img/arrow-right.png') }}" alt="Следующая" style="width: 25px; height: 25px;">
                </a>
            </li>
            {% else %}
            <li class="page-item disabled">
                <span class="page-link"><img src="{{ url_for('static', filename='img/arrow-right.png') }}" alt="Следующая" style="width: 25px; height: 25px; opacity: 0.3;"></span>
            </li>
            {% endif %}

            <!-- Последняя страница -->
            {% if dances.page < dances.pages %}
            <li class="page-item">
                <a class="page-link" href="{{ url_for('index', page=dances.pages, per_page=per_page, search=search) }}" aria-label="Last">
                    <img src="{{ url_for('static', filename='img/double-arrow-right.png') }}" alt="Последняя" style="width: 25px; height: 25px;">
                </a>
            </li>
            {% else %}
            <li class="page-item disabled">
                <span class="page-link"><img src="{{ url_for('static', filename='img/double-arrow-right.png') }}" alt="Последняя" style="width: 25px; height: 25px; opacity: 0.3;"></span>
            </li>
            {% endif %}
        </ul>
    </nav>
</div>
{% endif %}

<!-- Информация о пагинации -->
{% if dances %}
<div class="text-muted text-center mt-3">
    <small>Показано {{ dances.items|length }} из {{ dances.total }} танцев (страница {{ dances.page }} из {{ dances.pages }})</small>
</div>
{% endif %}


<!-- JavaScript для управления чекбоксами, удалением и насыщенностью -->
<script>
// Функции для управления насыщенностью цветов
function setSaturation(level) {
    const root = document.documentElement;
    const buttons = ['btn-sat-low', 'btn-sat-medium', 'btn-sat-high'];
    
    // Убираем активный класс со всех кнопок
    buttons.forEach(btnId => {
        document.getElementById(btnId).classList.remove('active');
    });
    
    // Добавляем активный класс к выбранной кнопке
    document.getElementById(`btn-sat-${level}`).classList.add('active');
    
    // Устанавливаем уровень насыщенности
    switch(level) {
        case 'low':
            root.classList.add('saturation-low');
            root.classList.remove('saturation-medium', 'saturation-high');
            break;
        case 'medium':
            root.classList.add('saturation-medium');
            root.classList.remove('saturation-low', 'saturation-high');
            break;
        case 'high':
            root.classList.add('saturation-high');
            root.classList.remove('saturation-low', 'saturation-medium');
            break;
    }
    
    // Сохраняем настройку в localStorage
    localStorage.setItem('saturationPreference', level);
}

// Функции для настройки шрифтов
function setFormatFontSize(size) {
    document.documentElement.style.setProperty('--format-font-size', size);
    localStorage.setItem('formatFontSize', size);
}

function setFormatFontWeight(weight) {
    document.documentElement.style.setProperty('--format-font-weight', weight);
    localStorage.setItem('formatFontWeight', weight);
}

function setSetTypeFontSize(size) {
    document.documentElement.style.setProperty('--set-type-font-size', size);
    localStorage.setItem('setTypeFontSize', size);
}

function setSetTypeFontWeight(weight) {
    document.documentElement.style.setProperty('--set-type-font-weight', weight);
    localStorage.setItem('setTypeFontWeight', weight);
}

function setSizeFontSize(size) {
    document.documentElement.style.setProperty('--size-font-size', size);
    localStorage.setItem('sizeFontSize', size);
}

function setSizeFontWeight(weight) {
    document.documentElement.style.setProperty('--size-font-weight', weight);
    localStorage.setItem('sizeFontWeight', weight);
}

function setSizeFontFamily(family) {
    document.documentElement.style.setProperty('--size-font-family', family);
    localStorage.setItem('sizeFontFamily', family);
}

// Восстанавливаем настройки при загрузке
document.addEventListener('DOMContentLoaded', function() {
    // Восстанавливаем сохраненные настройки насыщенности
    const savedSaturation = localStorage.getItem('saturationPreference') || 'medium';
    setSaturation(savedSaturation);
    
    // Восстанавливаем настройки шрифтов
    const savedFormatFontSize = localStorage.getItem('formatFontSize');
    const savedFormatFontWeight = localStorage.getItem('formatFontWeight');
    const savedSetTypeFontSize = localStorage.getItem('setTypeFontSize');
    const savedSetTypeFontWeight = localStorage.getItem('setTypeFontWeight');
    const savedSizeFontSize = localStorage.getItem('sizeFontSize');
    const savedSizeFontWeight = localStorage.getItem('sizeFontWeight');
    const savedSizeFontFamily = localStorage.getItem('sizeFontFamily');
    
    if (savedFormatFontSize) setFormatFontSize(savedFormatFontSize);
    if (savedFormatFontWeight) setFormatFontWeight(savedFormatFontWeight);
    if (savedSetTypeFontSize) setSetTypeFontSize(savedSetTypeFontSize);
    if (savedSetTypeFontWeight) setSetTypeFontWeight(savedSetTypeFontWeight);
    if (savedSizeFontSize) setSizeFontSize(savedSizeFontSize);
    if (savedSizeFontWeight) setSizeFontWeight(savedSizeFontWeight);
    if (savedSizeFontFamily) setSizeFontFamily(savedSizeFontFamily);
});
</script>

<style>
/* ===== ФИКСИРОВАННАЯ ШИРИНА СТОЛБЦОВ ===== */
.table-compact.fixed-columns {
    table-layout: fixed;
    width: 100%;
}

/* Принудительная установка ширины для всех столбцов */
.table-compact.fixed-columns th:nth-child(1),
.table-compact.fixed-columns td:nth-child(1) {
    width: 60px;
    min-width: 60px;
    max-width: 60px;
}

.table-compact.fixed-columns th:nth-child(2),
.table-compact.fixed-columns td:nth-child(2) {
    width: 280px;
    min-width: 280px;
    max-width: 280px;
}

.table-compact.fixed-columns th:nth-child(3),
.table-compact.fixed-columns td:nth-child(3) {
    width: 120px;
    min-width: 120px;
    max-width: 120px;
}

.table-compact.fixed-columns th:nth-child(4),
.table-compact.fixed-columns td:nth-child(4) {
    width: 130px;
    min-width: 130px;
    max-width: 130px;
}

.table-compact.fixed-columns th:nth-child(5),
.table-compact.fixed-columns td:nth-child(5) {
    width: 130px;
    min-width: 130px;
    max-width: 130px;
}

.table-compact.fixed-columns th:nth-child(6),
.table-compact.fixed-columns td:nth-child(6) {
    width: 100px;
    min-width: 100px;
    max-width: 100px;
}

.table-compact.fixed-columns th:nth-child(7),
.table-compact.fixed-columns td:nth-child(7) {
    width: 90px;
    min-width: 90px;
    max-width: 90px;
}

.table-compact.fixed-columns th:nth-child(8),
.table-compact.fixed-columns td:nth-child(8) {
    width: 140px;
    min-width: 140px;
    max-width: 140px;
}

/* Обрезка длинного текста */
.table-compact.fixed-columns td {
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}

/* ===== СТИЛИ ДЛЯ ИКОНОК МАТЕРИАЛОВ И ДЕЙСТВИЙ ===== */
.material-icon {
    cursor: default;
    transition: all 0.2s ease;
    opacity: 0.8;
}

.material-icon:hover {
    opacity: 1;
    transform: scale(1.1);
}

.material-icon-action {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s ease;
    opacity: 0.8;
    padding: 2px;
    border-radius: 4px;
}

.material-icon-action:hover {
    opacity: 1;
    transform: scale(1.1);
    background-color: rgba(0, 0, 0, 0.05);
}

/* ===== ВЫРАВНИВАНИЕ ПО ЦЕНТРУ ===== */
.table-compact td.text-center > * {
    justify-content: center;
}

/* ===== КОМПАКТНЫЕ ОТСТУПЫ ДЛЯ ГРУППЫ ИКОНОК ===== */
.d-flex.gap-1 {
    gap: 0.2rem !important;
}

.d-flex.gap-2 {
    gap: 0.5rem !important;
}

/* ===== ОСНОВНЫЕ СТИЛИ ТАБЛИЦЫ ===== */
.table-compact td {
    padding: 4px 6px;
    font-size: 0.9rem; 
    vertical-align: middle;
    height: 20px;
}

.table-compact th {
    padding: 8px 6px;
    font-size: 0.85rem; 
    vertical-align: middle;
    font-weight: 600;
}

/* ===== СТИЛИ ДЛЯ ID ТАНЦА ===== */
.table-compact td:first-child {
    font-size: 0.85rem;
    color: #6c757d;
    font-weight: 500;
    text-align: center;
}

/* ===== СТИЛИ ДЛЯ НАЗВАНИЯ ТАНЦА ===== */
.dance-name {
    font-weight: 600 !important;
    color: var(--primary-color) !important;
    font-size: 1rem;
    line-height: 1.2;
}

.dance-name:hover {
    color: #0a58ca !important;
    text-decoration: underline !important;
}

/* ===== СТИЛИ ДЛЯ БЕЙДЖЕЙ ТИПОВ ТАНЦЕВ ===== */
.badge-type {
    font-size: 1rem;
    padding: 0.2rem 0.4rem;
    vertical-align: middle;
    display: inline-block;
    line-height: 1;
    font-weight: 600;
    min-width: 70px;
    text-align: center;
    border-radius: 8px;
}

/* Бледные цвета для типов танцев */
.bg-reel {
    background-color: var(--reel-color) !important;
    color: var(--reel-text) !important;
}

.bg-jig {
    background-color: var(--jig-color) !important;
    color: var(--jig-text) !important;
}

.bg-strathspey {
    background-color: var(--strathspey-color) !important;
    color: var(--strathspey-text) !important;
}

.bg-medley {
    background-color: var(--medley-color) !important;
    color: var(--medley-text) !important;
}

.bg-polka {
    background-color: var(--polka-color) !important;
    color: var(--polka-text) !important;
}

.bg-march {
    background-color: var(--march-color) !important;
    color: var(--march-text) !important;
}

.bg-waltz {
    background-color: var(--waltz-color) !important;
    color: var(--waltz-text) !important;
}

.bg-hornpipe {
    background-color: var(--hornpipe-color) !important;
    color: var(--hornpipe-text) !important;
}

.bg-quadrille {
    background-color: var(--quadrille-color) !important;
    color: var(--quadrille-text) !important;
}

.bg-minuet {
    background-color: var(--minuet-color) !important;
    color: var(--minuet-text) !important;
}

/* ===== СТИЛИ ДЛЯ РАЗМЕРА ТАНЦА ===== */
.dance-size {
    font-size: 1rem;
    vertical-align: middle;
    display: inline-block;
    line-height: 1;
    color: #6c757d;
    font-weight: 500;
}

.dance-format, .dance-set-type {
    font-size: 1rem;
    color: #6c757d;
    font-weight: 500;
}

/* ===== СТИЛИ ДЛЯ КНОПОК-ИКОНОК ===== */
.btn-icon {
    padding: 0.2rem 0.35rem;
    border-radius: 4px;
    font-size: 1rem;
    transition: all 0.2s ease;
    vertical-align: middle;
}

.btn-icon:hover {
    transform: translateY(-1px);
}

/* ===== ВЫРАВНИВАНИЕ ЭЛЕМЕНТОВ В ТАБЛИЦЕ ===== */
.table-compact td > * {
    vertical-align: middle;
}

/* ===== СТИЛИ ДЛЯ УВЕДОМЛЕНИЙ ===== */
.alert {
    font-size: 1rem;
    margin-bottom: 1rem;
}

/* ===== ВЫРАВНИВАНИЕ ТЕКСТА В ТАБЛИЦЕ ===== */
.table-compact th.text-start,
.table-compact td.text-start {
    text-align: left;
}

.table-compact th.text-end,
.table-compact td.text-end {
    text-align: right;
}

/* ===== ВЫРАВНИВАНИЕ ГРУППЫ КНОПОК ===== */
.btn-group.justify-content-end {
    width: auto;
    margin-left: auto;
}

/* ===== АДАПТИВНОСТЬ ===== */
@media (max-width: 991.98px) {
    .col-lg-3 {
        margin-bottom: 1.5rem;
    }
    
    .table-compact td,
    .table-compact th {
        padding: 4px 3px;
        font-size: 0.75rem;
    }
    
    .dance-name {
        font-size: 0.8rem;
    }
    
    .badge-type {
        font-size: 0.65rem;
        padding: 0.15rem 0.3rem;
        min-width: 65px;
    }

    .material-icon {
        width: 12px !important;
        height: 12px !important;
    }
    
    .material-icon-action img {
        width: 16px !important;
        height: 16px !important;
    }
}

@media (max-width: 767.98px) {
    .card-body {
        padding: 1rem;
    }
    
    .form-select[multiple] {
        min-height: 60px;
    }
}
</style>
{% endblock %}
[file content end]