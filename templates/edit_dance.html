{% extends "base.html" %}

{% block title %}Редактировать танец - База данных танцев{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-10 mx-auto">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h2 class="card-title mb-0">Редактировать танец</h2>
            </div>
            <div class="card-body">
                <form method="POST">
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="name" class="form-label">Наименование *</label>
                            <input type="text" class="form-control" id="name" name="name" required 
                                   value="{{ dance.name }}"
                                   placeholder="Введите название танца">
                        </div>
                        <div class="col-md-6">
                            <label for="author" class="form-label">Автор</label>
                            <input type="text" class="form-control" id="author" name="author" 
                                   value="{{ dance.author or '' }}"
                                   placeholder="Автор танца">
                        </div>
                    </div>

                    <div class="row mb-3">
                        <div class="col-md-4">
                            <label for="dance_type" class="form-label">Тип танца *</label>
                            <select class="form-select" id="dance_type" name="dance_type" required>
                                <option value="">Выберите тип танца</option>
                                {% if dance_types %}
                                    {% for dance_type in dance_types %}
                                    <option value="{{ dance_type.id }}" 
                                            {% if dance.dance_type_id == dance_type.id %}selected{% endif %}>
                                        {{ dance_type.name }}
                                    </option>
                                    {% endfor %}
                                {% endif %}
                            </select>
                            <div class="form-text">
                                <a href="{{ url_for('manage_dance_types') }}" class="text-decoration-none">
                                    + Добавить новый тип танца
                                </a>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <label for="count_id" class="form-label">Повторы</label>
                            <input type="number" class="form-control" id="count_id" name="count_id" 
                                   value="{{ dance.count_id or '' }}"
                                   min="0" placeholder="8">
                        </div>
                        <div class="col-md-4">
                            <label for="size_id" class="form-label">Размер (такты)</label>
                            <input type="number" class="form-control" id="size_id" name="size_id" 
                                   value="{{ dance.size_id or '' }}"
                                   min="0" placeholder="32">
                        </div>
                    </div>

                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="dance_format" class="form-label">Формат сета</label>
                            <select class="form-select" id="dance_format" name="dance_format">
                                <option value="">Выберите формат сета</option>
                                {% if dance_formats %}
                                    {% for format in dance_formats %}
                                    <option value="{{ format.id }}" 
                                            {% if dance.dance_format_id == format.id %}selected{% endif %}>
                                        {{ format.name }}
                                    </option>
                                    {% endfor %}
                                {% endif %}
                            </select>
                            <div class="form-text">
                                <a href="{{ url_for('manage_dance_formats') }}" class="text-decoration-none">
                                    + Добавить/изменить формат сета
                                </a>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <label for="dance_couple" class="form-label">Танцующие пары</label>
                            <input type="text" class="form-control" id="dance_couple" name="dance_couple" 
                                   value="{{ dance.dance_couple or '' }}"
                                   placeholder="3C">
                        </div>
                    </div>

                    <div class="mb-3">
                        <label for="set_type" class="form-label">Тип сета</label>
                        <select class="form-select" id="set_type" name="set_type">
                            <option value="">Выберите тип сета</option>
                            {% if set_types %}
                                {% for set_type in set_types %}
                                <option value="{{ set_type.id }}" 
                                        {% if dance.set_type_id == set_type.id %}selected{% endif %}>
                                    {{ set_type.name }}
                                </option>
                                {% endfor %}
                            {% endif %}
                        </select>
                        <div class="form-text">
                            <a href="{{ url_for('manage_set_types') }}" class="text-decoration-none">
                                + Добавить новый тип сета
                            </a>
                        </div>
                    </div>

                    <!-- ДОБАВЛЕНО: Поле RSCDS -->
                    <div class="mb-3">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="rscds" name="rscds" value="true"
                                   {% if dance.rscds %}checked{% endif %}>
                            <label class="form-check-label" for="rscds">
                                RSCDS HQ publication
                            </label>
                        </div>
                        <div class="form-text">
                            Отметьте, если танец является публикацией штаб-квартиры RSCDS
                        </div>
                    </div>

                    <!-- ОПИСАНИЯ В ДВЕ КОЛОНКИ -->
                    <div class="row mb-3">
                        <!-- Левая колонка: MiniCribs -->
                        <div class="col-md-6">
                            <label for="description" class="form-label">
                                <i class="fas fa-file-alt text-primary"></i> MiniCribs
                            </label>
                            <textarea class="form-control" id="description" name="description" rows="8" 
                                      placeholder="Краткое описание в формате MiniCribs:
1-8 Полный оборот вправо...
9-16 Променад...
">{{ dance.description or '' }}</textarea>
                            <div class="form-text">
                                Краткое описание шагов по тактам в формате MiniCribs
                            </div>
                        </div>

                        <!-- Правая колонка: E-Cribs -->
                        <div class="col-md-6">
                            <label for="description2" class="form-label">
                                <i class="fas fa-file-text text-success"></i> E-Cribs
                            </label>
                            <textarea class="form-control" id="description2" name="description2" rows="8" 
                                      placeholder="Подробное описание в формате E-Cribs:
Bars 1-8: Все танцоры делают полный оборот вправо...
Bars 9-16: Первая и третья пары идут на променад...
">{{ dance.description2 or '' }}</textarea>
                            <div class="form-text">
                                Подробное описание с пояснениями в формате E-Cribs
                            </div>
                        </div>
                    </div>

                    <!-- ДОБАВЛЕНО: Поле Источник -->
                    <div class="mb-3">
                        <label for="source_url" class="form-label">Источник (URL)</label>
                        <input type="url" class="form-control" id="source_url" name="source_url" 
                               value="{{ dance.source_url or '' }}"
                               placeholder="https://example.com/dance-source">
                        <div class="form-text">
                            Ссылка на оригинальный источник танца (опционально)
                        </div>
                    </div>

                    <div class="mb-3">
                        <label for="published" class="form-label">Публикация</label>
                        <input type="text" class="form-control" id="published" name="published" 
                               value="{{ dance.published or '' }}"
                               placeholder="Published book 32">
                    </div>

                    <div class="mb-3">
                        <label for="note" class="form-label">Заметки</label>
                        <textarea class="form-control" id="note" name="note" rows="3" 
                                  placeholder="Дополнительные заметки...">{{ dance.note or '' }}</textarea>
                    </div>

                    <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                        <a href="{{ url_for('view_dance', dance_id=dance.id) }}" class="btn btn-secondary me-md-2">Отмена</a>
                        <button type="submit" class="btn btn-primary">Обновить танец</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Информация о танце -->
        <div class="card mt-4">
            <div class="card-header">
                <h5 class="card-title mb-0">Информация о записи</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <p><strong>ID записи:</strong> {{ dance.id }}</p>
                        <p><strong>Дата создания:</strong> {{ dance.created_at.strftime('%d.%m.%Y %H:%M') if dance.created_at else 'Не указана' }}</p>
                    </div>
                    <div class="col-md-6">
                        <p><strong>Дата обновления:</strong> {{ dance.updated_at.strftime('%d.%m.%Y %H:%M') if dance.updated_at else 'Не указана' }}</p>
                        {% if dance.source_url %}
                        <p><strong>Источник:</strong> <a href="{{ dance.source_url }}" target="_blank">{{ dance.source_url[:50] }}...</a></p>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}