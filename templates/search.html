{% extends "base.html" %}

{% block title %}–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –ø–æ–∏—Å–∫ —Ç–∞–Ω—Ü–µ–≤ - –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Ç–∞–Ω—Ü–µ–≤{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1>üîç –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –ø–æ–∏—Å–∫ —Ç–∞–Ω—Ü–µ–≤</h1>
            <a href="{{ url_for('index') }}" class="btn btn-outline-secondary">‚Üê –ù–∞–∑–∞–¥ –∫ –∫–∞—Ç–∞–ª–æ–≥—É</a>
        </div>

        <!-- –§–æ—Ä–º–∞ –ø–æ–∏—Å–∫–∞ -->
        <div class="card mb-4">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0">üìã –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–∏—Å–∫–∞</h5>
            </div>
            <div class="card-body">
                <form method="POST" id="searchForm">
                    <div class="row">
                        <!-- –õ–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ -->
                        <div class="col-md-6">
                            <!-- –ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é -->
                            <div class="mb-3">
                                <label for="name" class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–∞–Ω—Ü–∞</label>
                                <input type="text" class="form-control" id="name" name="name" 
                                       value="{{ filters.name }}"
                                       placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏–ª–∏ —á–∞—Å—Ç—å –Ω–∞–∑–≤–∞–Ω–∏—è...">
                                <div class="form-text">–ü–æ–∏—Å–∫ –ø–æ —á–∞—Å—Ç–∏—á–Ω–æ–º—É —Å–æ–≤–ø–∞–¥–µ–Ω–∏—é –≤ –Ω–∞–∑–≤–∞–Ω–∏–∏</div>
                            </div>

                            <!-- –ü–æ–∏—Å–∫ –ø–æ –∞–≤—Ç–æ—Ä—É -->
                            <div class="mb-3">
                                <label for="author" class="form-label">–ê–≤—Ç–æ—Ä</label>
                                <input type="text" class="form-control" id="author" name="author" 
                                       value="{{ filters.author }}"
                                       placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è –∞–≤—Ç–æ—Ä–∞...">
                            </div>

                            <!-- –¢–∏–ø—ã —Ç–∞–Ω—Ü–µ–≤ -->
                            <div class="mb-3">
                                <label class="form-label">–¢–∏–ø —Ç–∞–Ω—Ü–∞</label>
                                <div class="filter-scroll" style="max-height: 200px; overflow-y: auto;">
                                    {% for dance_type in dance_types %}
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" 
                                               name="dance_types" value="{{ dance_type.id }}" 
                                               id="type_{{ dance_type.id }}"
                                               {% if dance_type.id|string in filters.dance_types %}checked{% endif %}>
                                        <label class="form-check-label" for="type_{{ dance_type.id }}">
                                            {{ dance_type.name }} ({{ dance_type.code }})
                                        </label>
                                    </div>
                                    {% endfor %}
                                </div>
                                <div class="form-text">–í—ã–±–µ—Ä–∏—Ç–µ –æ–¥–∏–Ω –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ç–∏–ø–æ–≤</div>
                            </div>

                            <!-- –§–æ—Ä–º–∞—Ç—ã —Å–µ—Ç–æ–≤ -->
                            <div class="mb-3">
                                <label class="form-label">–§–æ—Ä–º–∞—Ç —Å–µ—Ç–∞</label>
                                <div class="filter-scroll" style="max-height: 200px; overflow-y: auto;">
                                    {% for format in dance_formats %}
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" 
                                               name="dance_formats" value="{{ format.id }}" 
                                               id="format_{{ format.id }}"
                                               {% if format.id|string in filters.dance_formats %}checked{% endif %}>
                                        <label class="form-check-label" for="format_{{ format.id }}">
                                            {{ format.name }}
                                        </label>
                                    </div>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>

                        <!-- –ü—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ -->
                        <div class="col-md-6">
                            <!-- –¢–∏–ø—ã —Å–µ—Ç–æ–≤ -->
                            <div class="mb-3">
                                <label class="form-label">–¢–∏–ø —Å–µ—Ç–∞</label>
                                <div class="filter-scroll" style="max-height: 150px; overflow-y: auto;">
                                    {% for set_type in set_types %}
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" 
                                               name="set_types" value="{{ set_type.id }}" 
                                               id="set_type_{{ set_type.id }}"
                                               {% if set_type.id|string in filters.set_types %}checked{% endif %}>
                                        <label class="form-check-label" for="set_type_{{ set_type.id }}">
                                            {{ set_type.name }}
                                        </label>
                                    </div>
                                    {% endfor %}
                                </div>
                            </div>

                            <!-- –¢–∞–Ω—Ü—É—é—â–∏–µ –ø–∞—Ä—ã -->
                            <div class="mb-3">
                                <label class="form-label">–¢–∞–Ω—Ü—É—é—â–∏–µ –ø–∞—Ä—ã</label>
                                <div class="filter-scroll" style="max-height: 150px; overflow-y: auto;">
                                    {% for couple in dance_couples %}
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" 
                                               name="dance_couples" value="{{ couple.dance_couple }}" 
                                               id="couple_{{ loop.index }}"
                                               {% if couple.dance_couple in filters.dance_couples %}checked{% endif %}>
                                        <label class="form-check-label" for="couple_{{ loop.index }}">
                                            {{ couple.dance_couple }}
                                        </label>
                                    </div>
                                    {% endfor %}
                                </div>
                            </div>

                            <!-- –ü—É–±–ª–∏–∫–∞—Ü–∏—è -->
                            <div class="mb-3">
                                <label for="published" class="form-label">–ü—É–±–ª–∏–∫–∞—Ü–∏—è</label>
                                <input type="text" class="form-control" id="published" name="published" 
                                       value="{{ filters.published }}"
                                       placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏...">
                            </div>

                            <!-- –ü–æ–≤—Ç–æ—Ä—ã -->
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label for="count_min" class="form-label">–ü–æ–≤—Ç–æ—Ä—ã (–æ—Ç)</label>
                                    <input type="number" class="form-control" id="count_min" name="count_min" 
                                           value="{{ filters.count_min }}" min="0" placeholder="0">
                                </div>
                                <div class="col-md-6">
                                    <label for="count_max" class="form-label">–ü–æ–≤—Ç–æ—Ä—ã (–¥–æ)</label>
                                    <input type="number" class="form-control" id="count_max" name="count_max" 
                                           value="{{ filters.count_max }}" min="0" placeholder="100">
                                </div>
                            </div>

                            <!-- –†–∞–∑–º–µ—Ä (—Ç–∞–∫—Ç—ã) -->
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label for="size_min" class="form-label">–†–∞–∑–º–µ—Ä —Ç–∞–∫—Ç–æ–≤ (–æ—Ç)</label>
                                    <input type="number" class="form-control" id="size_min" name="size_min" 
                                           value="{{ filters.size_min }}" min="0" placeholder="0">
                                </div>
                                <div class="col-md-6">
                                    <label for="size_max" class="form-label">–†–∞–∑–º–µ—Ä —Ç–∞–∫—Ç–æ–≤ (–¥–æ)</label>
                                    <input type="number" class="form-control" id="size_max" name="size_max" 
                                           value="{{ filters.size_max }}" min="0" placeholder="200">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
                    <div class="row mt-4">
                        <div class="col-12">
                            <div class="d-flex justify-content-between">
                                <button type="button" class="btn btn-outline-secondary" onclick="clearForm()">
                                    üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã
                                </button>
                                <div>
                                    <button type="submit" class="btn btn-primary me-2">
                                        üîç –í—ã–ø–æ–ª–Ω–∏—Ç—å –ø–æ–∏—Å–∫
                                    </button>
                                    <a href="{{ url_for('index') }}" class="btn btn-outline-danger">–û—Ç–º–µ–Ω–∞</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞ -->
        {% if results %}
        <div class="card">
            <div class="card-header bg-success text-white d-flex justify-content-between align-items-center">
                <h5 class="mb-0">üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞</h5>
                <span class="badge bg-light text-dark">{{ total_count }} –Ω–∞–π–¥–µ–Ω–æ</span>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-striped table-hover">
                        <thead class="table-dark">
                            <tr>
                                <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                                <th>–ê–≤—Ç–æ—Ä</th>
                                <th>–¢–∏–ø</th>
                                <th>–†–∞–∑–º–µ—Ä</th>
                                <th>–§–æ—Ä–º–∞—Ç</th>
                                <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for dance in results %}
                            <tr>
<td>
    <a href="{{ url_for('view_dance', dance_id=dance.id) }}" 
       class="text-decoration-none fw-bold text-dark">
        {{ dance.name }}
    </a>
</td>
                                <td>{{ dance.author or '-' }}</td>
                                <td>
                                    {% if dance.dance_type_rel %}
                                    <span class="badge 
                                        {% if dance.dance_type_rel.name == 'Reel' %}bg-primary
                                        {% elif dance.dance_type_rel.name == 'Jig' %}bg-success
                                        {% elif dance.dance_type_rel.name == 'Strathspey' %}bg-warning
                                        {% else %}bg-secondary{% endif %}">
                                        {{ dance.dance_type_rel.name }}
                                    </span>
                                    {% else %}
                                    <span class="badge bg-secondary">-</span>
                                    {% endif %}
                                </td>
                                <td>
                                    {% if dance.count_id and dance.size_id %}
                                        {{ dance.count_id }}x{{ dance.size_id }}
                                    {% elif dance.size_id %}
                                        {{ dance.size_id }} —Ç–∞–∫—Ç–æ–≤
                                    {% else %}
                                        -
                                    {% endif %}
                                </td>
                                <td>{{ dance.dance_format_rel.name if dance.dance_format_rel else '-' }}</td>
                                <td>
                                    <div class="btn-group btn-group-sm">
                                        <a href="{{ url_for('view_dance', dance_id=dance.id) }}" 
                                           class="btn btn-outline-info" title="–ü—Ä–æ—Å–º–æ—Ç—Ä">
                                            <i class="fas fa-eye"></i>
                                        </a>
                                        <a href="{{ url_for('dance_files', dance_id=dance.id) }}" 
                                           class="btn btn-outline-success" title="–§–∞–π–ª—ã">
                                            <i class="fas fa-folder"></i>
                                        </a>
                                        <a href="{{ url_for('edit_dance', dance_id=dance.id) }}" 
                                           class="btn btn-outline-primary" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">
                                            <i class="fas fa-edit"></i>
                                        </a>
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        {% endif %}
    </div>
</div>

<script>
function clearForm() {
    // –û—á–∏—â–∞–µ–º –≤—Å–µ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ –ø–æ–ª—è
    document.querySelectorAll('input[type="text"], input[type="number"]').forEach(input => {
        input.value = '';
    });
    
    // –°–Ω–∏–º–∞–µ–º –≤—Å–µ —á–µ–∫–±–æ–∫—Å—ã
    document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
        checkbox.checked = false;
    });
}

// –ê–≤—Ç–æ-—Å–∞–±–º–∏—Ç –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
document.addEventListener('DOMContentLoaded', function() {
    const autoSubmitFilters = document.querySelectorAll('input[type="checkbox"], input[type="number"]');
    autoSubmitFilters.forEach(filter => {
        filter.addEventListener('change', function() {
            // –ú–æ–∂–Ω–æ —Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–æ–∏—Å–∫–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤
            // document.getElementById('searchForm').submit();
        });
    });
});
</script>

<style>
.filter-scroll {
    border: 1px solid #dee2e6;
    border-radius: 0.375rem;
    padding: 10px;
    background-color: #f8f9fa;
}
.form-check {
    margin-bottom: 0.25rem;
}
.form-check-label {
    font-size: 0.9rem;
}
</style>
{% endblock %}